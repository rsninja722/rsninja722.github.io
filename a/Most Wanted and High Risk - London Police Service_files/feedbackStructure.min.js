jQuery(function(e){"use strict";var a=window.console||e.noop;e.fn.feedbackForm=function(i){function s(e,a){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=t.exec(a);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))}function d(e){return e.replace(/(?:\r\n|\r|\n)/g," ").replace(/"/g,'\\"')}function n(){if(l(),u()){var a=0===L.find("textarea:visible").length?"":L.find("textarea:visible").val();m.previewMode||e.ajax({url:m.baseUrl+m.postUrl,data:"data="+encodeURIComponent('{"firstName":"'+d(Y.val())+'","lastName":"'+d(D.val())+'","email":"'+d(A.val())+'","comments":"'+d(a)+'","rating":"'+T+'","category":"'+d(N.find("li.ui-tabs-active a").text())+'","pageTitle":"'+d(jQuery.trim(m.pageTitle))+'","browserResolution":"'+e(window).width()+"x"+e(window).height()+'","pageUrl":"'+d(document.URL.split("?")[0].replace("#",""))+'"}'),contentType:"application/json; charset=utf-8",dataType:"jsonp",jsonp:"jsonp"}),p(),f()}}function l(){C.html(""),F.html(""),M.html(""),E.html("")}function o(e){e&&(R.append(e),U.show(),U.append(H),U.append(R),x=!0)}function r(a){void 0!==a&&a.preventDefault();var t=P.dialog({autoOpen:!1,width:m.formModalWidth,modal:!0});t.dialog("open"),e("div.feedbackModal").closest("div.ui-dialog").find(".ui-dialog-titlebar").hide(),e(".ui-dialog-titlebar-close").blur()}function f(){var a=G.dialog({autoOpen:!1,width:m.thankYouModalWidth,modal:!0});a.dialog("open"),e("div.feedbackModalThankyou").closest("div.ui-dialog").find(".ui-dialog-titlebar").hide(),e(".ui-dialog-titlebar-close").blur()}function p(){P.dialog("close")}function c(){l(),G.dialog("close")}function u(){var e=!0;if(-1==T&&(C.append("Please select a rating."),e=!1),x===!0&&(H.checked||(E.append("Please agree to the rules of contacting us."),e=!1)),m.contactInfoRequired){var a=!Y.is(":visible")||Y.val(),t=!D.is(":visible")||D.val(),i=!A.is(":visible")||A.val();a&&t&&i||(M.append("Please provide your contact information."),e=!1)}return e}var m=e.extend(!0,{},t,i),h=e("<div>").addClass("ffLoadingContainer").html(m.loadingText),g=e("<div>").addClass("ffLogo"),b=e("<h1>").addClass("ffHeaderText"),v=e("<div>").addClass("ffFeedbackText"),k=e("<div>").addClass("ffOneToTenContainer"),C=e("<div>").addClass("numberRatingFeedbackValidationMessage").addClass("ffValidation"),T=-1,x=!1,y=e("<div>").addClass("ffCategoryText"),F=e("<div>").addClass("specificFeedbackValidationMessage").addClass("ffValidation"),L=e("<div>").addClass("ffSpecificContainer"),N=e("<ul>"),w=e("<div>").addClass("ffContactContainer"),U=e("<div>").addClass("ffAgreeTermsContainer"),M=e("<div>").addClass("contactValidationMessage").addClass("ffValidation"),S=e("<h2>").addClass("ffContactHeaderText"),I=e("<div>").addClass("ffContactFormDescriptionText"),B=e("<label for='ffFirstName'>").addClass("ffContactFieldLabel"),j=e("<label for='ffLastName'>").addClass("ffContactFieldLabel"),V=e("<label for='ffEmail'>").addClass("ffContactFieldLabel"),R=e("<label for='ffagreeTermsId'></label>").addClass("ffAgreeTermsLabel"),E=e("<div>").addClass("agreeTermsFeedbackValidationMessage").addClass("ffValidation"),Y=e("<input id='ffFirstName'>").addClass("ffFirstName").addClass("ic-form-control").prop("type","text").prop("maxlength",m.firstNameLength.toString()).on("keyup",function(){e(this).val().length>m.firstNameLength&&e(this).val(e(this).val().substring(0,m.firstNameLength))}),D=e("<input id='ffLastName'>").addClass("ffLastName").addClass("ic-form-control").prop("type","text").prop("maxlength",m.lastNameLength.toString()).on("keyup",function(){e(this).val().length>m.lastNameLength&&e(this).val(e(this).val().substring(0,m.lastNameLength))}),A=e("<input id='ffEmail'>").addClass("ffEmail").addClass("ic-form-control").prop("type","text").prop("maxlength",m.emailLength.toString()).on("keyup",function(){e(this).val().length>m.emailLength&&e(this).val(e(this).val().substring(0,m.emailLength))}),H=document.createElement("input");H.type="checkbox",H.name="ffagreeTermsName",H.value="ffagreeTermsValue",H.id="ffagreeTermsId",H.className="ffAgreeTermsCheckBox";var O=e("<div>").addClass("ffFeedbackClose").html(m.closeText).click(p),q=e("<button>").addClass("ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close").attr("type","button").attr("role","button").attr("title","Close").click(p).html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span><span class='ui-button-text'>Close</span>"),P=e("<div>").addClass("feedbackModal").addClass("container").attr("style","display:none;").append(h).append(g).append(e("<form>").prop("role","form").append(e("<input>").prop("type","submit").attr("aria-hidden","true").attr("style","display:none;")).append(e("<div>").addClass("ffFormContainer").append(b).append(e("<div>").addClass("ffFormGroup").append(v).append(k).append(C)).append(e("<div>").addClass("clear")).append(y).append(L.append(N)).append(F).append(w).append(M).append(U).append(E)).append(e("<div>").addClass("button-group").append(O).append(e("<div>").addClass("ffFeedbackButton").click(n).append(e("<div>").addClass("ffButtonLeft")).append(e("<div>").addClass("ffButtonMiddle").html(m.sendText)).append(e("<div>").addClass("ffButtonRight"))))),W=e("<h1>").addClass("ffThankYouTextHeader"),Q=e("<button>").addClass("ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close").attr("type","button").attr("role","button").attr("title","Close").click(c).html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span><span class='ui-button-text'>Close</span>"),_=e("<p>").addClass("ffThankYouFormDescription"),G=e("<div>").addClass("feedbackModalThankyou").attr("title",m.thankYouModalTitle).attr("style","display:none;").append(W).append(Q).append(_).append("<br /><br />").append(e("<div>").addClass("button-group").append(e("<div>").addClass("ffFeedbackButton").click(c).append(e("<div>").addClass("ffButtonLeft")).append(e("<div>").addClass("ffButtonMiddle").html(m.closeThankYouText)).append(e("<div>").addClass("ffButtonRight"))));m.showButton&&(this.filter("div").each(function(){e(this).addClass("feedbackTabButton").show().click(r).html(e("<div>").html(m.buttonText))}),this.filter("a").each(function(){e(this).addClass("feedbackTabButton").show().click(r)}),this.filter("body").each(function(){e(this).prepend(e("<div>").addClass("feedbackTabButton").addClass("ffDefaultTab").click(r).append(e("<div>").html(m.buttonText)))})),m.feedbackFormId=e.trim(m.feedbackFormId.toString()),""!==m.feedbackFormId&&(m.getUrl="/form/"+m.feedbackFormId+"/definition",m.postUrl="/form/"+m.feedbackFormId+"/response"),U.hide();var z=function(t){var i=t.length>0?t[0]:t;if(!i||!i.fields)return void a.log("Failed to obtain feedback form definition");i.fields.logo=(i.fields.logo||"").replace("http:",window.location.protocol),m.contactInfoRequired=i.fields.contactInfoRequired,m.agreementTerms=i.fields.agreementTerms,(""===m.skin||void 0===m.skin)&&(m.skin=s("skin",i.fields.skinBaseUrl).toString()),(""===m.skinVersion||void 0===m.skinVersion)&&(m.skinVersion=s("version",i.fields.skinBaseUrl).toString()),m.agreementTerms&&o(m.agreementTerms),m.feedbackFormId=i.id,m.getUrl="/form/"+i.id.toString()+"/definition",m.postUrl="/form/"+i.id.toString()+"/response";var d=m.jsServerUrl+"/skins/"+m.skin+"/"+m.skinVersion+"/styles/feedback.min.css";if(document.createStyleSheet)document.createStyleSheet(d);else{var n=document.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=d,e("head").append(n)}var l=100,r=i.fields.ratings.length;r>0&&(l=Math.floor(100/r));var f=100;r=i.fields.categories.length,r>0&&(f=Math.floor(100/r));var p=0;e(i.fields.categories).each(function(){p++,N.append("<li style='width:"+f+"%'><a href='#ff-tabs-"+p+"'>"+this.title+"</a></li>"),L.append(e("<div>").attr("id","ff-tabs-"+p).append(e("<label for='ff-tabs-txt-"+p+"'>").append(e("<h2>").html(this.title))).append(e("<p>").addClass("ffSpecificDescription").html(this.instruction)).append(e("<textarea id='ff-tabs-txt-"+p+"'>").addClass("ffSuggestionField").addClass("ic-form-control").attr("maxlength",m.suggestionLength).on("keyup",function(){e(this).val().length>m.suggestionLength&&e(this).val(e(this).val().substring(0,m.suggestionLength))})))}),i.fields.ratings.sort(function(e,a){return(e.rank||0)-(a.rank||0)}),e(i.fields.ratings).each(function(){var a=this.rank;k.append(e("<div>").attr("style","width:"+l+"%").click(function(){T=a,k.find("div").removeClass("selected"),C.html(""),e(this).addClass("selected")}).addClass("ffRecommendButton").addClass("ItemSelectArea").html(this.title))}),L.tabs({collapsible:!0,active:!1}),g.append('<img src="'+i.fields.logo+'" ng-src="'+i.fields.logo+'" alt="'+i.logoAltText+'" class="img-responsive">'),g.append(q),b.empty().append(i.fields.headerText),v.append(i.fields.feedbackText),S.append(i.fields.contactHeaderText),I.append(i.fields.contactFormDescriptionText),y.append(i.fields.categoryText),B.html(m.firstNameText),j.html(m.lastNameText),V.append(m.emailText),W.append(i.fields.thankYouTextHeader),_.append(i.fields.thankYouFormDescription),(i.fields.askForFirstName||i.fields.askForLastName||i.fields.askForEmail)&&(w.append(S),""!==I.html()&&w.append(I)),void 0!==i.fields.askForFirstName&&i.fields.askForFirstName&&(w.append(B),w.append(Y)),void 0!==i.fields.askForLastName&&i.fields.askForLastName&&(w.append(j),w.append(D)),void 0!==i.fields.askForEmail&&i.fields.askForEmail&&(w.append(V),w.append(A)),h.hide()};0===m.baseUrl.indexOf("//")?m.baseUrl="https:"+m.baseUrl:m.baseUrl=m.baseUrl.replace(/^http:\/\//i,"https://");var J=e.ajax({url:m.baseUrl+m.getUrl,contentType:"application/json; charset=utf-8",dataType:"jsonp",jsonp:"jsonp",success:z});return J.error(function(e,t,i){"timeout"==t&&a.log("The server is not responding"),"error"==t&&a.log(i)}),m.showButton||r(),this};var t={useDefaultIfNoIdIsSet:!0,baseUrl:"http://icreate-stg.esolutionsgroup.ca/feedback/api/1.0/",getUrl:"client/239000_97_201_iCreateTemplate/default-form/en",postUrl:"",jsServerUrl:"http://js.esolutionsgroup.ca/js/libs/feedback-form/",skin:"",skinVersion:"",previewMode:!1,contactInfoRequired:!1,agreementTerms:"",feedbackFormLoaded:!1,showButton:!0,buttonText:"Feedback",feedbackFormId:"",pageTitle:"",loadingText:"Please wait while this form loads...",firstNameLength:63,lastNameLength:63,emailLength:255,firstNameText:"First Name:",lastNameText:"Last Name:",emailText:"Email:",suggestionLength:400,closeText:"Or cancel",sendText:"Send Feedback",closeThankYouText:"Close",thankYouModalTitle:"Thank you for your feedback!",language:"en",thankYouModalWidth:600,formModalWidth:600}}(jQuery));