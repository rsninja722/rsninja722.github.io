(function(e){function t(e,t,n){var r=parseInt(e.css("top"),10);var i="-"+this.image_wrapper_height+"px";e.css("top",this.image_wrapper_height+"px");if(n){n.css("bottom","-"+n[0].offsetHeight+"px");n.animate({bottom:0},this.settings.animation_speed*2)}if(this.current_description){this.current_description.animate({bottom:"-"+this.current_description[0].offsetHeight+"px"},this.settings.animation_speed*2)}return{old_image:{top:i},new_image:{top:r}}}function n(e,t,n){var r=parseInt(e.css("left"),10);var i="-"+this.image_wrapper_width+"px";e.css("left",this.image_wrapper_width+"px");if(n){n.css("bottom","-"+n[0].offsetHeight+"px");n.animate({bottom:0},this.settings.animation_speed*2)}if(this.current_description){this.current_description.animate({bottom:"-"+this.current_description[0].offsetHeight+"px"},this.settings.animation_speed*2)}return{old_image:{left:i},new_image:{left:r}}}function r(e,t,n){var r=e.width();var i=e.height();var s=parseInt(e.css("left"),10);var o=parseInt(e.css("top"),10);e.css({width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2});return{old_image:{width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2},new_image:{width:r,height:i,top:o,left:s}}}function i(e,t,n){e.css("opacity",0);return{old_image:{opacity:0},new_image:{opacity:1}}}function s(e,t,n){e.css("opacity",0);return{old_image:{opacity:0},new_image:{opacity:1},speed:0}}function o(e,t){this.init(e,t)}function u(e,t){this.init(e,t)}e.fn.adGallery=function(t){var n={start_at_index:0,description_wrapper:false,thumb_opacity:.7,animate_first_image:false,animation_speed:400,width:false,height:false,display_next_and_prev:true,display_back_and_forward:true,scroll_jump:0,slideshow:{enable:true,autostart:false,speed:5e3,start_label:'<img src="https://icreate4.esolutionsgroup.ca/230002_iCreatePhotoGalleryV2/Images/play-button.png" alt="Start" />',stop_label:'<img src="https://icreate4.esolutionsgroup.ca/230002_iCreatePhotoGalleryV2/Images/pause-button.png" alt="Stop" />',stop_on_scroll:true,countdown_prefix:"(",countdown_sufix:")",onStart:false,onStop:false},effect:"slide-hori",enable_keyboard_move:true,cycle:true,callbacks:{init:false,afterImageVisible:false,beforeImageVisible:false}};var r=e.extend(false,n,t);if(t&&t.slideshow){r.slideshow=e.extend(false,n.slideshow,t.slideshow)}if(!r.slideshow.enable){r.slideshow.autostart=false}var i=[];e(this).each(function(){var e=new o(this,r);i[i.length]=e});return i};o.prototype={wrapper:false,image_wrapper:false,gallery_info:false,nav:false,loader:false,preloads:false,thumbs_wrapper:false,scroll_back:false,scroll_forward:false,next_link:false,prev_link:false,slideshow:false,image_wrapper_width:0,image_wrapper_height:0,current_index:0,current_image:false,current_description:false,nav_display_width:0,settings:false,images:false,in_transition:false,animations:false,init:function(t,n){var r=this;this.wrapper=e(t);this.settings=n;this.setupElements();this.setupAnimations();if(this.settings.width){this.image_wrapper_width=this.settings.width;this.image_wrapper.width(this.settings.width);this.wrapper.width(this.settings.width)}else{this.image_wrapper_width=this.image_wrapper.width()}if(this.settings.height){this.image_wrapper_height=this.settings.height;this.image_wrapper.height(this.settings.height)}else{this.image_wrapper_height=this.image_wrapper.height()}this.nav_display_width=this.nav.width();this.current_index=0;this.current_image=false;this.current_description=false;this.in_transition=false;this.findImages();if(this.settings.display_next_and_prev){this.initNextAndPrev()}var i=function(e){return r.nextImage(e)};this.slideshow=new u(i,this.settings.slideshow);this.controls.append(this.slideshow.create());if(this.settings.slideshow.enable){this.slideshow.enable()}else{this.slideshow.disable()}if(this.settings.display_back_and_forward){this.initBackAndForward()}if(this.settings.enable_keyboard_move){this.initKeyEvents()}var s=parseInt(this.settings.start_at_index,10);if(window.location.hash&&window.location.hash.indexOf("#ad-image")===0){s=window.location.hash.replace(/[^0-9]+/g,"");if(s*1!=s){s=this.settings.start_at_index}}this.loading(true);this.showImage(s,function(){if(r.settings.slideshow.autostart){r.preloadImage(s+1);r.slideshow.start()}});this.fireCallback(this.settings.callbacks.init)},setupAnimations:function(){this.animations={"slide-vert":t,"slide-hori":n,resize:r,fade:i,none:s}},setupElements:function(){this.controls=this.wrapper.find(".ad-controls");this.gallery_info=e('<p class="ad-info"></p>');this.controls.append(this.gallery_info);this.image_wrapper=this.wrapper.find(".ad-image-wrapper");this.image_wrapper.empty();this.nav=this.wrapper.find(".ad-nav");this.thumbs_wrapper=this.nav.find(".ad-thumbs");this.preloads=e('<div class="ad-preloads"></div>');this.loader=e('<img class="ad-loader" src="'+this.settings.loader_image+'">');this.image_wrapper.append(this.loader);this.loader.hide();e(document.body).append(this.preloads)},loading:function(e){if(e){this.loader.show()}else{this.loader.hide()}},addAnimation:function(t,n){if(e.isFunction(n)){this.animations[t]=n}},findImages:function(){var t=this;this.images=[];var n=0;var r=0;var i=this.thumbs_wrapper.find("a");var s=i.length;if(this.settings.thumb_opacity<1){i.find("img").css("opacity",this.settings.thumb_opacity)}i.each(function(i){if(e(this).attr("datetoshow")==undefined||new Date(e(this).attr("datetoshow"))<new Date&&new Date(e(this).attr("datetonotshow"))>new Date){var s=e(this);var o=s.attr("href");var u=s.find("img");if(!t.isImageLoaded(u[0])){u.load(function(){n+=this.parentNode.parentNode.offsetWidth;r++})}else{n+=u[0].parentNode.parentNode.offsetWidth;r++}s.addClass("ad-thumb"+i);s.click(function(){t.showImage(i);t.slideshow.stop();t.slideshow.start();return false}).hover(function(){if(!e(this).is(".ad-active")&&t.settings.thumb_opacity<1){e(this).find("img").fadeTo(300,1)}t.preloadImage(i)},function(){if(!e(this).is(".ad-active")&&t.settings.thumb_opacity<1){e(this).find("img").fadeTo(300,t.settings.thumb_opacity)}});var s=false;var a=false;var f=false;if(u.data("ad-link")){s=u.data("ad-link")}else if(u.attr("longdesc")&&u.attr("longdesc").length){s=u.attr("longdesc")}if(u.attr("linkTarget")&&u.attr("linkTarget").length){a=u.attr("linkTarget")}if(u.attr("linkTitle")&&u.attr("linkTitle").length){f=u.attr("linkTitle")}var l=false;if(u.data("ad-desc")){l=u.data("ad-desc")}else if(u.attr("alt")&&u.attr("alt").length){l=u.attr("alt")}var c=false;if(u.data("ad-title")){c=u.data("ad-title")}else if(u.attr("title")&&u.attr("title").length){c=u.attr("title")}t.images[i]={thumb:u.attr("src"),image:o,error:false,preloaded:false,desc:l,title:c,size:false,link:s,linkTarget:a,linkTitle:f}}else{e(this).css("display","none")}});var o=setInterval(function(){if(s==r){n-=60;var e=t.nav.find(".ad-thumb-list");e.css("width",n+"px");var i=1;var u=e.height();while(i<201){e.css("width",n+i+"px");if(u!=e.height()){break}u=e.height();i++}clearInterval(o)}},100)},initKeyEvents:function(){var t=this;e(document).keydown(function(e){if(e.keyCode==39){t.nextImage();t.slideshow.stop();t.slideshow.start()}else if(e.keyCode==37){t.prevImage();t.slideshow.stop();t.slideshow.start()}})},initNextAndPrev:function(){this.next_link=e('<div class="ad-next"><div class="ad-next-image"></div></div>');this.prev_link=e('<div class="ad-prev"><div class="ad-prev-image"></div></div>');this.image_wrapper.append(this.next_link);this.image_wrapper.append(this.prev_link);var t=this;this.prev_link.add(this.next_link).mouseover(function(n){e(this).css("height",t.image_wrapper_height);e(this).find("div").show()}).mouseout(function(t){e(this).find("div").hide()}).click(function(){if(e(this).is(".ad-next")){t.nextImage();t.slideshow.stop();t.slideshow.start()}else{t.prevImage();t.slideshow.stop();t.slideshow.start()}}).find("div").css("opacity",.7)},initBackAndForward:function(){var t=this;this.scroll_forward=e('<div class="ad-forward"></div>');this.scroll_back=e('<div class="ad-back"></div>');this.nav.append(this.scroll_forward);this.nav.prepend(this.scroll_back);var n=0;var r=false;e(this.scroll_back).add(this.scroll_forward).click(function(){var n=t.nav_display_width-50;if(t.settings.scroll_jump>0){var n=t.settings.scroll_jump}if(e(this).is(".ad-forward")){var r=t.thumbs_wrapper.scrollLeft()+n}else{var r=t.thumbs_wrapper.scrollLeft()-n}if(t.settings.slideshow.stop_on_scroll){t.slideshow.stop();t.slideshow.start()}t.thumbs_wrapper.animate({scrollLeft:r+"px"});return false}).css("opacity",.6).hover(function(){var i="left";if(e(this).is(".ad-forward")){i="right"}r=setInterval(function(){n++;if(n>30&&t.settings.slideshow.stop_on_scroll){t.slideshow.stop();t.slideshow.start()}var e=t.thumbs_wrapper.scrollLeft()+1;if(i=="left"){e=t.thumbs_wrapper.scrollLeft()-1}t.thumbs_wrapper.scrollLeft(e)},10);e(this).css("opacity",1)},function(){n=0;clearInterval(r);e(this).css("opacity",.6)})},_afterShow:function(){this.gallery_info.html(this.current_index+1+" / "+this.images.length);if(!this.settings.cycle){this.prev_link.show().css("height",this.image_wrapper_height);this.next_link.show().css("height",this.image_wrapper_height);if(this.current_index==this.images.length-1){this.next_link.hide()}if(this.current_index==0){this.prev_link.hide()}}this.fireCallback(this.settings.callbacks.afterImageVisible)},_getContainedImageSize:function(e,t){if(t>this.image_wrapper_height){var n=e/t;t=this.image_wrapper_height;e=this.image_wrapper_height*n}if(e>this.image_wrapper_width){var n=t/e;e=this.image_wrapper_width;t=this.image_wrapper_width*n}return{width:e,height:t}},_centerImage:function(e,t,n){e.css("top","0px");if(n<this.image_wrapper_height){var r=this.image_wrapper_height-n;e.css("top",r/2+"px")}e.css("left","0px");if(t<this.image_wrapper_width){var r=this.image_wrapper_width-t;e.css("left",r/2+"px")}},_getDescription:function(t){var n=false;e("."+t.image.toString().replace("/uploads/","").replace(".jpg","").replace("/230002_iCreatePhotoGalleryV2","")).hide();n=e("."+t.image.toString().replace("/uploads/","").replace(".jpg","").replace("/230002_iCreatePhotoGalleryV2","")).html();if(n==null){n=""}else{n=e('<p class="ad-image-description">'+n+"</p>")}return n},showImage:function(e,t){if(this.images[e]&&!this.in_transition){var n=this;var r=this.images[e];this.in_transition=true;if(!r.preloaded){this.loading(true);this.preloadImage(e,function(){n.loading(false);n._showWhenLoaded(e,t)})}else{this._showWhenLoaded(e,t)}}},_showWhenLoaded:function(t,n){if(this.images[t]){var r=this;var i=this.images[t];var s=e(document.createElement("div")).addClass("ad-image");var o=e(new Image).attr("src",i.image);if(i.title){o.attr("alt",i.title);o.attr("title",i.title)}if(i.link){var u=e('<a href="'+i.link+'" target="'+i.linkTarget+'" title="'+i.linkTitle+'"></a>');u.append(o);s.append(u)}else{s.append(o)}this.image_wrapper.prepend(s);var a=this._getContainedImageSize(i.size.width,i.size.height);o.attr("width",a.width);o.attr("height",a.height);s.css({width:a.width+"px",height:a.height+"px"});this._centerImage(s,a.width,a.height);var f=this._getDescription(i,s);if(f){if(!this.settings.description_wrapper){s.append(f);var l=a.width-parseInt(f.css("padding-left"),10)-parseInt(f.css("padding-right"),10);f.css("width",l+"px")}else{this.settings.description_wrapper.append(f)}}this.highLightThumb(this.nav.find(".ad-thumb"+t));var c="right";if(this.current_index<t){c="left"}this.fireCallback(this.settings.callbacks.beforeImageVisible);if(this.current_image||this.settings.animate_first_image){var h=this.settings.animation_speed;var p="swing";var d=this.animations[this.settings.effect].call(this,s,c,f);if(typeof d.speed!="undefined"){h=d.speed}if(typeof d.easing!="undefined"){p=d.easing}if(this.current_image){var v=this.current_image;var m=this.current_description;v.animate(d.old_image,h,p,function(){v.remove();if(m)m.remove()})}s.animate(d.new_image,h,p,function(){r.current_index=t;r.current_image=s;r.current_description=f;r.in_transition=false;r._afterShow();r.fireCallback(n)})}else{this.current_index=t;this.current_image=s;r.current_description=f;this.in_transition=false;r._afterShow();this.fireCallback(n)}}},nextIndex:function(){if(this.current_index==this.images.length-1){if(!this.settings.cycle){return false}var e=0}else{var e=this.current_index+1}return e},nextImage:function(e){var t=this.nextIndex();if(t===false)return false;this.preloadImage(t+1);this.showImage(t,e);return true},prevIndex:function(){if(this.current_index==0){if(!this.settings.cycle){return false}var e=this.images.length-1}else{var e=this.current_index-1}return e},prevImage:function(e){var t=this.prevIndex();if(t===false)return false;this.preloadImage(t-1);this.showImage(t,e);return true},preloadAll:function(){function n(){if(t<e.images.length){t++;e.preloadImage(t,n)}}var e=this;var t=0;e.preloadImage(t,n)},preloadImage:function(t,n){if(this.images[t]){var r=this.images[t];if(!this.images[t].preloaded){var i=e(new Image);i.attr("src",r.image);if(!this.isImageLoaded(i[0])){this.preloads.append(i);var s=this;i.load(function(){r.preloaded=true;r.size={width:this.width,height:this.height};s.fireCallback(n)}).error(function(){r.error=true;r.preloaded=false;r.size=false})}else{r.preloaded=true;r.size={width:i[0].width,height:i[0].height};this.fireCallback(n)}}else{this.fireCallback(n)}}},isImageLoaded:function(e){if(typeof e.complete!="undefined"&&!e.complete){return false}if(typeof e.naturalWidth!="undefined"&&e.naturalWidth==0){return false}return true},highLightThumb:function(e){this.thumbs_wrapper.find(".ad-active").removeClass("ad-active");e.addClass("ad-active");if(this.settings.thumb_opacity<1){this.thumbs_wrapper.find("a:not(.ad-active) img").fadeTo(300,this.settings.thumb_opacity);e.find("img").fadeTo(300,1)}var t=e[0].parentNode.offsetLeft;t-=this.nav_display_width/2-e[0].offsetWidth/2;this.thumbs_wrapper.animate({scrollLeft:t+"px"})},fireCallback:function(t){if(e.isFunction(t)){t.call(this)}}};u.prototype={start_link:false,stop_link:false,countdown:false,controls:false,settings:false,nextimage_callback:false,enabled:false,running:false,countdown_interval:false,init:function(e,t){var n=this;this.nextimage_callback=e;this.settings=t},create:function(){this.start_link=e('<span class="ad-slideshow-start">'+this.settings.start_label+"</span>");this.stop_link=e('<span class="ad-slideshow-stop">'+this.settings.stop_label+"</span>");this.countdown=e('<span class="ad-slideshow-countdown"></span>');this.controls=e('<div class="ad-slideshow-controls"></div>');this.controls.append(this.start_link).append(this.stop_link).append(this.countdown);this.countdown.hide();var t=this;this.start_link.click(function(){t.start()});this.stop_link.click(function(){t.stop()});e(document).keydown(function(e){if(e.keyCode==83){if(t.running){t.stop()}else{t.start()}}});return this.controls},disable:function(){this.enabled=false;this.stop();this.controls.hide()},enable:function(){this.enabled=true;this.controls.show()},toggle:function(){if(this.enabled){this.disable()}else{this.enable()}},start:function(){if(this.running||!this.enabled)return false;var e=this;this.running=true;this.controls.addClass("ad-slideshow-running");this._next();this.fireCallback(this.settings.onStart);return true},stop:function(){if(!this.running)return false;this.running=false;this.countdown.hide();this.controls.removeClass("ad-slideshow-running");clearInterval(this.countdown_interval);this.fireCallback(this.settings.onStop);return true},_next:function(){var e=this;var t=this.settings.countdown_prefix;var n=this.settings.countdown_sufix;clearInterval(e.countdown_interval);this.countdown.show().html(t+this.settings.speed/1e3+n);var r=0;this.countdown_interval=setInterval(function(){r+=1e3;if(r>=e.settings.speed){var i=function(){if(e.running){e._next()}r=0};if(!e.nextimage_callback(i)){e.stop()}r=0}var s=parseInt(e.countdown.text().replace(/[^0-9]/g,""),10);s--;if(s>0){e.countdown.html(t+s+n)}},1e3)},fireCallback:function(t){if(e.isFunction(t)){t.call(this)}}}})(jQuery)