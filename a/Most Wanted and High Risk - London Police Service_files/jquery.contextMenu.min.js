// jQuery Context Menu Plugin
//
// Version 1.00
//
// Cory S.N. LaViska
// A Beautiful Site (http://abeautifulsite.net/)
//
// Visit http://abeautifulsite.net/notebook/80 for usage and more information
//
// Terms of Use
//
// This software is licensed under a Creative Commons License and is copyrighted
// (C)2008 by Cory S.N. LaViska.
//
// For details, visit http://creativecommons.org/licenses/by/3.0/us/
//
// Jay Dobson <jdobson@esolutionsgrop.ca>
// 
// Added isMenuLoaded boolean flag to be able to target the interior element when items with 
// context menu events attached to them are nested.
//
var isMenuLoaded=false;if(jQuery)(function(){jQuery.extend(jQuery.fn,{contextMenu:function(e,t){if(e.menu==undefined)return false;if(e.inSpeed==undefined)e.inSpeed=150;if(e.outSpeed==undefined)e.outSpeed=75;if(e.inSpeed==0)e.inSpeed=-1;if(e.outSpeed==0)e.outSpeed=-1;jQuery(this).each(function(){var n=jQuery(this);var r=jQuery(n).offset();jQuery("#"+e.menu).addClass("contextMenu");jQuery(this).mousedown(function(i){var s=i;jQuery(this).mouseup(function(i){var u=jQuery(this);jQuery(this).unbind("mouseup");if(s.button==2&&!isMenuLoaded){isMenuLoaded=true;jQuery(".contextMenu").hide();var a=jQuery("#"+e.menu);if(jQuery(n).hasClass("disabled"))return false;var f={},l,c;if(self.innerHeight){f.pageYOffset=self.pageYOffset;f.pageXOffset=self.pageXOffset;f.innerHeight=self.innerHeight;f.innerWidth=self.innerWidth}else if(document.documentElement&&document.documentElement.clientHeight){f.pageYOffset=document.documentElement.scrollTop;f.pageXOffset=document.documentElement.scrollLeft;f.innerHeight=document.documentElement.clientHeight;f.innerWidth=document.documentElement.clientWidth}else if(document.body){f.pageYOffset=document.body.scrollTop;f.pageXOffset=document.body.scrollLeft;f.innerHeight=document.body.clientHeight;f.innerWidth=document.body.clientWidth}i.pageX?l=i.pageX:l=i.clientX+f.scrollLeft;i.pageY?c=i.pageY:l=i.clientY+f.scrollTop;jQuery(document).unbind("click");jQuery(a).css("top",c+"px");jQuery(a).css("left",l+"px");jQuery(a).fadeIn(e.inSpeed);jQuery(a).find("A").mouseover(function(){jQuery(a).find("LI.hover").removeClass("hover");jQuery(this).parent().addClass("hover")}).mouseout(function(){jQuery(a).find("LI.hover").removeClass("hover")});jQuery(document).keypress(function(e){switch(e.keyCode){case 38:if(jQuery(a).find("LI.hover").size()==0){jQuery(a).find("LI:last").addClass("hover")}else{jQuery(a).find("LI.hover").removeClass("hover").prevAll("LI:not(.disabled)").eq(0).addClass("hover");if(jQuery(a).find("LI.hover").size()==0)jQuery(a).find("LI:last").addClass("hover")}break;case 40:if(jQuery(a).find("LI.hover").size()==0){jQuery(a).find("LI:first").addClass("hover")}else{jQuery(a).find("LI.hover").removeClass("hover").nextAll("LI:not(.disabled)").eq(0).addClass("hover");if(jQuery(a).find("LI.hover").size()==0)jQuery(a).find("LI:first").addClass("hover")}break;case 13:jQuery(a).find("LI.hover A").trigger("click");break;case 27:jQuery(document).trigger("click");break}});jQuery("#"+e.menu).find("A").unbind("click");jQuery("#"+e.menu).find("LI:not(.disabled) A").click(function(){jQuery(document).unbind("click").unbind("keypress");jQuery(".contextMenu").hide();url=jQuery(this).attr("href");url=url.substring(url.indexOf("#")+1);if(t)t(url,jQuery(u),{x:l-r.left,y:c-r.top,docX:l,docY:c});return false});setTimeout(function(){jQuery(document).click(function(){jQuery(document).unbind("click").unbind("keypress");jQuery(a).fadeOut(e.outSpeed);isMenuLoaded=false;return false})},0)}})});jQuery("#"+e.menu).each(function(){jQuery(this).bind("mousedown.disableTextSelect",function(){return false})});jQuery(n).add("UL.contextMenu").bind("contextmenu",function(){return false})});return jQuery(this)},disableContextMenuItems:function(e){if(e==undefined){jQuery(this).find("LI").addClass("disabled");return jQuery(this)}jQuery(this).each(function(){if(e!=undefined){var t=e.split(",");for(var n=0;n<t.length;n++){jQuery(this).find('A[href="'+t[n]+'"]').parent().addClass("disabled")}}});return jQuery(this)},enableContextMenuItems:function(e){if(e==undefined){jQuery(this).find("LI.disabled").removeClass("disabled");return jQuery(this)}jQuery(this).each(function(){if(e!=undefined){var t=e.split(",");for(var n=0;n<t.length;n++){jQuery(this).find('A[href="'+t[n]+'"]').parent().removeClass("disabled")}}});return jQuery(this)},disableContextMenu:function(){jQuery(this).each(function(){jQuery(this).addClass("disabled")});return jQuery(this)},enableContextMenu:function(){jQuery(this).each(function(){jQuery(this).removeClass("disabled")});return jQuery(this)},destroyContextMenu:function(){jQuery(this).each(function(){jQuery(this).unbind("mousedown").unbind("mouseup")});return jQuery(this)}})})(jQuery)